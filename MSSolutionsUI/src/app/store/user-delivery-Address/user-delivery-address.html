<h2 class="popup-title">Select Address  <button class="close-btn" (click)="close()">Ã—</button></h2>
<div class="maindiv">
<form [formGroup]="form">

  <div class="row">
    <div class="col-sm-6"
         *ngFor="let addr of addresses">

      <div class="address-card">

        <!-- SHIPPING RADIO -->
        <div class="radio">
          <label>
            <input
              type="radio"
              formControlName="shippingAddressId"
              [value]="addr.id"
            />
            <strong>{{ addr.fullName }}</strong>
          </label>
        </div>

        <p class="address-text">
          {{ addr.addressLine }}, {{ addr.city }} - {{ addr.pincode }}<br />
          ðŸ“ž {{ addr.phone }}
        </p>

        <!-- BILLING RADIO -->
        <div class="radio billing-radio"
             *ngIf="!form.value.useShippingAsBilling">
          <label>
            <input
              type="radio"
              formControlName="billingAddressId"
              [value]="addr.id"
            />
            Use as Billing
          </label>
        </div>

      </div>
    </div>
  </div>

</form>

<hr />
<button class="btn btn-outline"
        (click)="showAddForm = !showAddForm">
  âž• Add New Address
</button>

<!-- ADD ADDRESS FORM -->
<form *ngIf="showAddForm"
      [formGroup]="addAddressForm"
      class="add-form">

  <div class="row">
    <div class="col-sm-6">
      <input class="form-control"
             placeholder="Full Name"
             formControlName="fullName" />
               <mat-error *ngIf="addAddressForm.get('fullName')?.hasError('required')">
             Full Name  is required
            </mat-error>
    </div>

    <div class="col-sm-6">
      <input class="form-control"
             placeholder="Phone"
             formControlName="phone" />
             <mat-error *ngIf="addAddressForm.get('phone')?.hasError('required')">
                Phone number is required
              </mat-error>

              <mat-error *ngIf="addAddressForm.get('phone')?.hasError('pattern')">
                Invalid phone number. Example: 9876543210
              </mat-error>
    </div>
  </div>

  <div class="row mt-10">
    <div class="col-sm-12">
      <input class="form-control"
             placeholder="Address"
             formControlName="addressLine" />
    </div>
  </div>

  <div class="row mt-10">
      <div class="col-4">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label class="mdc-text-field ">State</mat-label>
            <input matInput formControlName="stateId"
                   [matAutocomplete]="stateAuto"
                   (focus)="showState()"
                   (input)="showState()" />
            <mat-autocomplete #stateAuto="matAutocomplete" [displayWith]="displayState" autoActiveFirstOption (optionSelected)="onStateSelected($event.option.value)">
              <mat-option *ngFor="let state of filteredStates$ | async" [value]="state">{{ state.name }}</mat-option>
            </mat-autocomplete>
            <mat-error *ngIf="addAddressForm.get('stateId')?.hasError('required')">User State is required</mat-error>
          </mat-form-field>
    </div>

   <div class="col-4">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label class="mdc-text-field ">User City</mat-label>
            <input matInput formControlName="cityId"
                   [matAutocomplete]="cityAuto"
                   (focus)="showCities()"
                   (input)="showCities()" />
            <mat-autocomplete #cityAuto="matAutocomplete" [displayWith]="displayCities" autoActiveFirstOption (optionSelected)="onCitySelected($event.option.value)">
              <mat-option *ngFor="let city of filteredCities$ | async" [value]="city">{{ city.name }}</mat-option>
            </mat-autocomplete>
            <mat-error *ngIf="addAddressForm.get('cityId')?.hasError('required')">User City is required</mat-error>
          </mat-form-field>
        </div>

    <div class="col-4">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label class="mdc-text-field">User Pincode</mat-label>
            <input matInput formControlName="pincodeId"
                   [matAutocomplete]="pincodeAuto"
                   (focus)="showPincode()"
                   (input)="showPincode()" />
            <mat-autocomplete #pincodeAuto="matAutocomplete" [displayWith]="displayPincodes">
              <mat-option *ngFor="let pin of filteredPincodes$ | async" [value]="pin">{{ pin.pincode }}</mat-option>
            </mat-autocomplete>
            <mat-error *ngIf="addAddressForm.get('pincodeId')?.hasError('required')">User Pincode is required</mat-error>
          </mat-form-field>
        </div>
</div>
  <div class="text-right mt-10">
    <button type="button"
            class="btn btn-outline"
            (click)="addAddress()">
      Save Address
    </button>
  </div>

</form>

<hr />

<div class="actions text-right">
  <button class="btn btn-default"
          (click)="cancel()">
    Cancel
  </button>

  <button class="btn btn-primary"
          (click)="save()">
    Use Selected Address
  </button>
</div>
</div>